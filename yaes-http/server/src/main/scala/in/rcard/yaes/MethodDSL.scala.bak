package in.rcard.yaes

/** DSL for defining GET routes.
  *
  * Provides overloaded apply methods for routes with 0-4 parameters, ensuring compile-time type
  * safety.
  */
object GET {

  /** Define a GET route with no parameters.
    *
    * Example:
    * {{{
    * GET(p"/health") { req =>
    *   Response.ok("OK")
    * }
    * }}}
    */
  def apply[QueryP <: QueryParams](
      pattern: PathPattern[NoParams, QueryP]
  )(handler: Request => Response): Route[NoParams, QueryP] =
    Route(Method.GET, pattern, NoParamHandler(handler))

  /** Define a GET route with one parameter.
    *
    * Example:
    * {{{
    * val userId = param[Int]("userId")
    * GET(p"/users" / userId) { (req, id: Int) =>
    *   Response.ok(s"User $id")
    * }
    * }}}
    */
  def apply[N1 <: String & Singleton, T1, QueryP <: QueryParams](
      pattern: PathPattern[::[N1, T1, NoParams], QueryP]
  )(handler: (Request, T1) => Response): Route[::[N1, T1, NoParams], QueryP] =
    Route(Method.GET, pattern, OneParamHandler(handler))

  /** Define a GET route with two parameters. */
  def apply[N1 <: String & Singleton, T1, N2 <: String & Singleton, T2, QueryP <: QueryParams](
      pattern: PathPattern[::[N1, T1, ::[N2, T2, NoParams]], QueryP]
  )(handler: (Request, T1, T2) => Response): Route[::[N1, T1, ::[N2, T2, NoParams]], QueryP] =
    Route(Method.GET, pattern, TwoParamHandler(handler))

  /** Define a GET route with three parameters. */
  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]])(
      handler: (Request, T1, T2, T3) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]] =
    Route(Method.GET, pattern, ThreeParamHandler(handler))

  /** Define a GET route with four parameters. */
  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3,
      N4 <: String & Singleton,
      T4
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]])(
      handler: (Request, T1, T2, T3, T4) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]] =
    Route(Method.GET, pattern, FourParamHandler(handler))
}

/** DSL for defining POST routes. */
object POST {
  def apply(pattern: PathPattern[NoParams])(handler: Request => Response): Route[NoParams] =
    Route(Method.POST, pattern, NoParamHandler(handler))

  def apply[N1 <: String & Singleton, T1](
      pattern: PathPattern[::[N1, T1, NoParams]]
  )(handler: (Request, T1) => Response): Route[::[N1, T1, NoParams]] =
    Route(Method.POST, pattern, OneParamHandler(handler))

  def apply[N1 <: String & Singleton, T1, N2 <: String & Singleton, T2](
      pattern: PathPattern[::[N1, T1, ::[N2, T2, NoParams]]]
  )(handler: (Request, T1, T2) => Response): Route[::[N1, T1, ::[N2, T2, NoParams]]] =
    Route(Method.POST, pattern, TwoParamHandler(handler))

  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]])(
      handler: (Request, T1, T2, T3) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]] =
    Route(Method.POST, pattern, ThreeParamHandler(handler))

  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3,
      N4 <: String & Singleton,
      T4
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]])(
      handler: (Request, T1, T2, T3, T4) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]] =
    Route(Method.POST, pattern, FourParamHandler(handler))
}

/** DSL for defining PUT routes. */
object PUT {
  def apply(pattern: PathPattern[NoParams])(handler: Request => Response): Route[NoParams] =
    Route(Method.PUT, pattern, NoParamHandler(handler))

  def apply[N1 <: String & Singleton, T1](
      pattern: PathPattern[::[N1, T1, NoParams]]
  )(handler: (Request, T1) => Response): Route[::[N1, T1, NoParams]] =
    Route(Method.PUT, pattern, OneParamHandler(handler))

  def apply[N1 <: String & Singleton, T1, N2 <: String & Singleton, T2](
      pattern: PathPattern[::[N1, T1, ::[N2, T2, NoParams]]]
  )(handler: (Request, T1, T2) => Response): Route[::[N1, T1, ::[N2, T2, NoParams]]] =
    Route(Method.PUT, pattern, TwoParamHandler(handler))

  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]])(
      handler: (Request, T1, T2, T3) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]] =
    Route(Method.PUT, pattern, ThreeParamHandler(handler))

  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3,
      N4 <: String & Singleton,
      T4
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]])(
      handler: (Request, T1, T2, T3, T4) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]] =
    Route(Method.PUT, pattern, FourParamHandler(handler))
}

/** DSL for defining DELETE routes. */
object DELETE {
  def apply(pattern: PathPattern[NoParams])(handler: Request => Response): Route[NoParams] =
    Route(Method.DELETE, pattern, NoParamHandler(handler))

  def apply[N1 <: String & Singleton, T1](
      pattern: PathPattern[::[N1, T1, NoParams]]
  )(handler: (Request, T1) => Response): Route[::[N1, T1, NoParams]] =
    Route(Method.DELETE, pattern, OneParamHandler(handler))

  def apply[N1 <: String & Singleton, T1, N2 <: String & Singleton, T2](
      pattern: PathPattern[::[N1, T1, ::[N2, T2, NoParams]]]
  )(handler: (Request, T1, T2) => Response): Route[::[N1, T1, ::[N2, T2, NoParams]]] =
    Route(Method.DELETE, pattern, TwoParamHandler(handler))

  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]])(
      handler: (Request, T1, T2, T3) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]] =
    Route(Method.DELETE, pattern, ThreeParamHandler(handler))

  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3,
      N4 <: String & Singleton,
      T4
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]])(
      handler: (Request, T1, T2, T3, T4) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]] =
    Route(Method.DELETE, pattern, FourParamHandler(handler))
}

/** DSL for defining PATCH routes. */
object PATCH {
  def apply(pattern: PathPattern[NoParams])(handler: Request => Response): Route[NoParams] =
    Route(Method.PATCH, pattern, NoParamHandler(handler))

  def apply[N1 <: String & Singleton, T1](
      pattern: PathPattern[::[N1, T1, NoParams]]
  )(handler: (Request, T1) => Response): Route[::[N1, T1, NoParams]] =
    Route(Method.PATCH, pattern, OneParamHandler(handler))

  def apply[N1 <: String & Singleton, T1, N2 <: String & Singleton, T2](
      pattern: PathPattern[::[N1, T1, ::[N2, T2, NoParams]]]
  )(handler: (Request, T1, T2) => Response): Route[::[N1, T1, ::[N2, T2, NoParams]]] =
    Route(Method.PATCH, pattern, TwoParamHandler(handler))

  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]])(
      handler: (Request, T1, T2, T3) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, NoParams]]]] =
    Route(Method.PATCH, pattern, ThreeParamHandler(handler))

  def apply[
      N1 <: String & Singleton,
      T1,
      N2 <: String & Singleton,
      T2,
      N3 <: String & Singleton,
      T3,
      N4 <: String & Singleton,
      T4
  ](pattern: PathPattern[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]])(
      handler: (Request, T1, T2, T3, T4) => Response
  ): Route[::[N1, T1, ::[N2, T2, ::[N3, T3, ::[N4, T4, NoParams]]]]] =
    Route(Method.PATCH, pattern, FourParamHandler(handler))
}
